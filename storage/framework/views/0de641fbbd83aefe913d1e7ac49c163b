<?php
    //get the prefix of the page to set the nav to active
    $route = Route::current();
    $name = $route->getPrefix();
?>
<!-- sidebar: style can be found in sidebar.less -->
<section class="sidebar">
  <div class="user-panel">
    <div class="pull-left image">
        <?php
            $user = Session::get('_global_user');
            $userPhoto = $user->profile_picture;
        ?>
        <?php if( $userPhoto != '' ): ?>
            <img src="<?php echo e(url('public/uploads/profile_picture/'.$userPhoto)); ?>" class="profile-img img-circle" />
        <?php else: ?>
            <img src="<?php echo e(asset('public/dist/img/noimage_male.png')); ?>" class="profile-img img-circle" />
        <?php endif; ?>
    </div>
    <div class="pull-left info">
      <p>Welcome
        <?php $id = Auth::user()->user_id; ?>
        <a href="<?php echo e(url('/users',[$id])); ?>">
          <?php if( Auth::check() ): ?>
            <?php echo e(Auth::user()->first_name); ?> !
          <?php endif; ?>
        </a>
      </p>
      <a href="<?php echo e(url('/users',[$id])); ?>" class="btn btn-primary">Profile</a>
    </div>
  </div>

  <ul class="sidebar-menu">
    <li class="divider-bottom <?php if($name == 'dashboard'): ?> active <?php endif; ?>">
      <a href="<?php echo e(url('/')); ?>" class="<?php echo e(Request::is('/') ? 'active' : ''); ?>">
        <i class="fa fa-dashboard"></i> <span>Dashboard</span>
      </a>
    </li>
    <!-- Edited by RJBS -->
    <?php if(Cache::get('roles')): ?>
      <?php
          $modules = Cache::get('roles');
      ?>

      <!-- start Core modules -->
      <?php foreach($modules['modules'] as $k => $v): ?>
        <?php if( $v['name'] != 'dashboard' AND $v['icon'] != NULL AND $v['status'] == '1' AND $v['order'] < 10 ): ?>
          <li class="<?php if($name == $v['name']): ?> active <?php endif; ?>">
            <a href="<?php echo e(url( '/', $v['name'] )); ?>" class="<?php echo e(Request::is('*'.$v['name']) ? 'active' : ''); ?>">
              <i class="fa <?php echo e($v['icon']); ?>"></i> <span><?php echo e(ucfirst($v['name'])); ?></span>
            </a>
          </li>
        <?php endif; ?>
      <?php endforeach; ?>

      <!-- start extension modules -->
      <?php $cnt = 0; $totalc = 0; ?>
      <?php if(isset($modules['external_modules'])): ?>
        <?php $totalc = count($modules['external_modules']); ?>
        <?php foreach($modules['external_modules'] as $key => $val): ?>
          <?php $cnt++; ?>
          <?php $c = Config::get($key.'.icon'); ?>
          <li class="<?php if($name == $key): ?> active <?php endif; ?> <?php if($cnt == 1): ?> divider-top <?php endif; ?> <?php if($cnt == $totalc): ?> divider-bottom <?php endif; ?>">
            <a href="<?php echo e(url('/', $key)); ?>" class="<?php echo e(Request::is('*$key') ? 'active' : ''); ?>">
              <i class="fa <?php echo e($c); ?>"></i> <span><?php echo e(ucfirst($key)); ?></span>
            </a>
          </li>
        <?php endforeach; ?>
      <?php endif; ?>

      <!-- start Utility modules -->
      <?php foreach($modules['modules'] as $k => $v): ?>
        <?php if( $v['name'] != 'dashboard' AND $v['icon'] != NULL AND $v['status'] == '1' AND $v['order'] >= '10000' ): ?>
          <li class="<?php if($name == $v['name']): ?> active <?php endif; ?>">
            <a href="<?php echo e(url( '/', $v['name'] )); ?>" class="<?php echo e(Request::is('*'.$v['name']) ? 'active' : ''); ?>">
              <i class="fa <?php echo e($v['icon']); ?>"></i> <span><?php echo e(ucfirst($v['name'])); ?></span>
            </a>
          </li>
        <?php endif; ?>
      <?php endforeach; ?>

    <?php endif; ?>
    <!-- end RJBS edit -->
  </ul>
</section>
<!-- /.sidebar -->
